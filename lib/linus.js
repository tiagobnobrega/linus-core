!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash")):"function"==typeof define&&define.amd?define(["lodash"],t):"object"==typeof exports?exports.linus=t(require("lodash")):e.linus=t(e._)}(this,function(__WEBPACK_EXTERNAL_MODULE__0__){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__0__},function(e,t,r){"use strict";e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"numbers";return function(t){return r={},n=e,o=t.toUpperCase(),n in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,r;var r,n,o}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);Object.defineProperty(t,"Numbers",{enumerable:!0,get:function(){return(e=n,e&&e.__esModule?e:{default:e}).default;var e}})},function(e,t){var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},function(module,exports,__webpack_require__){var indexOf=__webpack_require__(3),Object_keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var r in e)t.push(r);return t},forEach=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(e,t,r){Object.defineProperty(e,t,{writable:!0,enumerable:!1,configurable:!0,value:r})}}catch(e){return function(e,t,r){e[t]=r}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(e){if(!(this instanceof Script))return new Script(e);this.code=e};Script.prototype.runInContext=function(e){if(!(e instanceof Context))throw new TypeError("needs a 'context' argument.");var t=document.createElement("iframe");t.style||(t.style={}),t.style.display="none",document.body.appendChild(t);var r=t.contentWindow,n=r.eval,o=r.execScript;!n&&o&&(o.call(r,"null"),n=r.eval),forEach(Object_keys(e),function(t){r[t]=e[t]}),forEach(globals,function(t){e[t]&&(r[t]=e[t])});var i=Object_keys(r),c=n.call(r,this.code);return forEach(Object_keys(r),function(t){(t in e||-1===indexOf(i,t))&&(e[t]=r[t])}),forEach(globals,function(t){t in e||defineProp(e,t,r[t])}),document.body.removeChild(t),c},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(e){var t=Script.createContext(e),r=this.runInContext(t);return forEach(Object_keys(t),function(r){e[r]=t[r]}),r},forEach(Object_keys(Script.prototype),function(e){exports[e]=Script[e]=function(t){var r=Script(t);return r[e].apply(r,[].slice.call(arguments,1))}}),exports.createScript=function(e){return exports.Script(e)},exports.createContext=Script.createContext=function(e){var t=new Context;return"object"==typeof e&&forEach(Object_keys(e),function(r){t[r]=e[r]}),t}},function(e,t,r){"use strict";e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Error;function t(e){var t=Error.call(this,e);Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:this.constructor.name,writable:!0}),Object.defineProperty(this,"message",{configurable:!0,enumerable:!1,value:e,writable:!0}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,this.constructor):Object.defineProperty(this,"stack",{configurable:!0,enumerable:!1,value:t.stack,writable:!0})}return t.prototype=Object.create(e.prototype),t}},function(e,t,r){"use strict";var n,o=r(5),i=(n=o)&&n.__esModule?n:{default:n};var c=r(0),u=r(4),a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,(0,i.default)()),t}();e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=u.createContext(c.merge(e,{module:{exports:null}})),r={require:function(e){if("string"!=typeof e)throw new a("Cannot compile code "+e+". Only strings allowed");t.module.exports=null;try{u.runInNewContext(e,t)}catch(e){throw new a("Error interpreting source code.")}return t.module.exports},interpretAttributes:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];n.forEach(function(t){var n=e[t];if(n){if("string"!=typeof t)throw new a("Cannot compile attribute "+t+". Only strings allowed");var o="module.exports = "+n;e[t]=r.require(o)}})}};return r}},function(e,t,r){"use strict";e.exports=function e(t){var r=new Error('Required parameter, "'+t+'" is missing.');throw"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(r,e),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=u(r(0)),i=u(r(7)),c=u(r(6));function u(e){return e&&e.__esModule?e:{default:e}}function a(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var c=t[o](i),u=c.value}catch(e){return void r(e)}if(!c.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}var f=function(){var e,t,r=this;this.src={},this.messageTokenizers={},this.interpretInteractionScritps=function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return n({},e,{condition:r.interpreter.require(e.condition),actions:r.interpretActions(e.actions)})})},this.interpretActions=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return n({},e,{condition:r.interpreter.require(e.condition),steps:r.interpretSteps(e.steps)})})},this.interpretSteps=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return n({},e,{feedback:o.default.isString(e.feedback)?r.interpreter.require(e.feedback):e.feedback})})},this.registerTokenizer=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(e&&e.id&&e.tokenize&&o.default.isFunction(e.tokenize)))throw new Error("invalid tokenizer "+(e&&e.id)+": missing or invalid attribute id or fn");if(!1===t&&r.messageTokenizers[e.id.toString()])throw new Error("tokenizer "+e.id+" already registered & overwrite attribute false");r.messageTokenizers[e.id]=e.tokenize},this.registerTokenizers=function(e){e.forEach(r.registerTokenizer)},this.runTokenizers=(e=s(regeneratorRuntime.mark(function e(t,n){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.map(function(e){return Promise.resolve(e.tokenize(t))}),e.abrupt("return",Promise.all(o).then(function(e){return Object.assign.apply(Object,a(e))}));case 2:case"end":return e.stop()}},e,r)})),function(t,r){return e.apply(this,arguments)}),this.getTokenizer=function(e){var t=r.messageTokenizers[e];if(!t)throw new Error("Tokenizer "+e+" not registered.");return t},this.getTokenizers=function(e){return e?e.map(r.getTokenizer):[]},this.getTopicTokenizers=function(e){var t=!1===e.useGlobalTokenizers?[]:r.getTokenizers(r.src.bot.globalTokenizers),n=r.getTokenizers(e.tokenizers||[]);return[].concat(a(t),a(n))},this.enrichContext=function(e,t){var r,o,i,c=n({},e.env);return n({},e,t,(i=c,(o="env")in(r={})?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,r))},this.getTopic=function(e){return r.src.topics[e]},this.use=function(e){var t=e.tokenizers,n=void 0===t?[]:t;r.registerTokenizers(n)},this.getTopicInteractions=function(e){},this.getInteractionCandidates=function(e,t){},this.getTargetInteraction=function(e,t){},this.getTopicTargetInteraction=function(e,t){var n=r.getTopicInteractions(e);return r.getTargetInteraction(n,t)},this.resolve=(t=s(regeneratorRuntime.mark(function e(t,n){var o,i,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.getTopic(n.env.topicId)||r.src.bot.rootTopic,i=r.getTopicTokenizers(o),e.next=4,r.runTokenizers(t,i);case 4:c=e.sent,u=r.enrichContext(n,c),r.getTargetInteraction(o,u);case 7:case"end":return e.stop()}},e,r)})),function(e,r){return t.apply(this,arguments)})};t.default=function e(t){var r=t.bot,n=void 0===r?(0,i.default)("bot"):r,u=t.topics,a=void 0===u?[]:u,s=t.interactions,l=void 0===s?[]:s,p=t.handlers,d=void 0===p?[]:p,h=t.tokenizers,v=void 0===h?[]:h,b=t.sandboxScope,y=void 0===b?{}:b;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),f.call(this),this.interpreter=(0,c.default)(y),this.src={bot:n,topics:o.default.keyBy(a,"id"),interactions:o.default.keyBy(this.interpretInteractionScritps(l),function(e){return e.topicId+":"+e.id})},d.forEach(this.use),this.registerTokenizers(v)},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(8),i=(n=o)&&n.__esModule?n:{default:n};var c=Symbol("base"),u=Symbol("baseFn"),a=function(e){return function(t){return function(r){e[t].apply(e,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(r))}}};t.default=function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resolve=function(e,t){return r[c].resolve(e,t)},this.use=function(e){return r[c].use(e)},this.registerTokenizer=function(e,t){return r[c].registerTokenizer(e,t)},this[c]=new i.default(t),this[u]=a(this[c])},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tokenizers=t.LinusDialog=void 0;var n=r(9);Object.defineProperty(t,"LinusDialog",{enumerable:!0,get:function(){return(e=n,e&&e.__esModule?e:{default:e}).default;var e}});var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(2));t.tokenizers=o}])});