!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("lodash")):"function"==typeof define&&define.amd?define(["lodash"],r):"object"==typeof exports?exports.linus=r(require("lodash")):e.linus=r(e._)}(this,function(e){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=6)}([function(e,r,t){"use strict";e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"numbers";return function(r){return t={},n=e,o=r.toUpperCase(),n in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t;var t,n,o}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(0);Object.defineProperty(r,"Numbers",{enumerable:!0,get:function(){return(e=n,e&&e.__esModule?e:{default:e}).default;var e}})},function(e,r,t){"use strict";e.exports=function e(r){var t=new Error('Required parameter, "'+r+'" is missing.');throw"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(t,e),t}},function(r,t){r.exports=e},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=i(t(3)),o=i(t(2));function i(e){return e&&e.__esModule?e:{default:e}}function u(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function s(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function n(o,i){try{var u=r[o](i),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var a=function(){var e,r,t=this;this.src={},this.messageTokenizers={},this.registerTokenizer=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(e&&e.id&&e.tokenize&&n.default.isFunction(e.tokenize)))throw new Error("invalid tokenizer "+(e&&e.id)+": missing or invalid attribute id or fn");if(!1===r&&t.messageTokenizers[e.id.toString()])throw new Error("tokenizer "+e.id+" already registered & overwrite attribute false");t.messageTokenizers[e.id]=e.tokenize},this.runTokenizers=(e=s(regeneratorRuntime.mark(function e(r,n){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.map(function(e){return Promise.resolve(e.tokenize(r))}),e.abrupt("return",Promise.all(o).then(function(e){return Object.assign.apply(Object,u(e))}));case 2:case"end":return e.stop()}},e,t)})),function(r,t){return e.apply(this,arguments)}),this.getTokenizer=function(e){var r=t.messageTokenizers[e];if(!r)throw new Error("Tokenizer "+e+" not registered.");return r},this.getTokenizers=function(e){return e?e.map(t.getTokenizer):[]},this.getTopicTokenizers=function(e){var r=t.getTokenizers(t.src.bot.globalTokenizers),n=t.getTokenizers(e.beforeGlobaltokenizers||[]),o=t.getTokenizers(e.afterGlobaltokenizers||[]);return[].concat(u(n),u(r),u(o))},this.getTopic=function(e){return t.src.topics[e]},this.registerTokenizers=function(e){e.forEach(t.registerTokenizer)},this.use=function(e){var r=e.tokenizers,n=void 0===r?[]:r;t.registerTokenizers(n)},this.resolve=(r=s(regeneratorRuntime.mark(function e(r,n){var o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.getTopic(n.env.topicId)||t.src.bot.rootTopic,i=t.getTopicTokenizers(o),e.next=4,t.runTokenizers(r,i);case 4:e.sent;case 5:case"end":return e.stop()}},e,t)})),function(e,t){return r.apply(this,arguments)})};r.default=function e(r){var t=r.bot,i=void 0===t?(0,o.default)("bot"):t,u=r.topics,s=void 0===u?[]:u,c=r.interactions,f=void 0===c?[]:c,l=r.handlers,d=void 0===l?[]:l,p=r.tokenizers,v=void 0===p?[]:p;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),a.call(this),this.src={bot:i,topics:n.default.keyBy(s,"id"),interactions:n.default.keyBy(f,function(e){return e.topicId+":"+e.id})},d.forEach(this.use),this.registerTokenizers(v)},e.exports=r.default},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=t(4),i=(n=o)&&n.__esModule?n:{default:n};var u=Symbol("base"),s=Symbol("baseFn"),a=function(e){return function(r){return function(t){e[r].apply(e,function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}(t))}}};r.default=function e(r){var t=this;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.resolve=function(e,r){return t[u].resolve(e,r)},this.use=function(e){return t[u].use(e)},this.registerTokenizer=function(e,r){return t[u].registerTokenizer(e,r)},this[u]=new i.default(r),this[s]=a(this[u])},e.exports=r.default},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.tokenizers=r.LinusDialog=void 0;var n=t(5);Object.defineProperty(r,"LinusDialog",{enumerable:!0,get:function(){return(e=n,e&&e.__esModule?e:{default:e}).default;var e}});var o=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}(t(1));r.tokenizers=o}])});