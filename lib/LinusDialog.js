!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("lodash")):"function"==typeof define&&define.amd?define(["lodash"],r):"object"==typeof exports?exports.LinusDialog=r(require("lodash")):(e.linus=e.linus||{},e.linus.LinusDialog=r(e._))}(this,function(e){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=6)}([,,,,function(e,r,t){"use strict";e.exports=function e(r){var t=new Error('Required parameter, "'+r+'" is missing.');throw"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(t,e),t}},function(r,t){r.exports=e},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=i(t(5)),o=i(t(4));function i(e){return e&&e.__esModule?e:{default:e}}function u(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function a(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function n(o,i){try{var u=r[o](i),a=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}("next")})}}r.default=function(e){var r,t,i,c,s,f,d,l,p,v,h,y,b={},m={},g=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(e&&e.id&&e.tokenize&&n.default.isFunction(e.tokenize)))throw new Error("invalid tokenizer "+(e&&e.id)+": missing or invalid attribute id or fn");if(!1===r&&m[e.id.toString()])throw new Error("tokenizer "+e.id+" already registered & overwrite attribute false");m[e.id]=e.tokenize},k=(r=a(regeneratorRuntime.mark(function e(r,t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(function(e){return Promise.resolve(e.tokenize(r))}),e.abrupt("return",Promise.all(n).then(function(e){return Object.assign.apply(Object,u(e))}));case 2:case"end":return e.stop()}},e,void 0)})),function(e,t){return r.apply(this,arguments)}),x=function(e){var r=m[e];if(!r)throw new Error("Tokenizer "+e+" not registered.");return r},w=function(e){return e?e.map(x):[]},z=function(e){var r=w(b.bot.globalTokenizers),t=w(e.beforeGlobaltokenizers||[]),n=w(e.afterGlobaltokenizers||[]);return[].concat(u(t),u(r),u(n))},j=function(e){e.forEach(g)},_=function(e){var r=e.tokenizers;j(void 0===r?[]:r)},E=(t=a(regeneratorRuntime.mark(function e(r,t){var n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.env.topicId,n=b.topics[i]||b.bot.rootTopic,o=z(n),e.next=4,k(r,o);case 4:e.sent;case 5:case"end":return e.stop()}var i},e,void 0)})),function(e,r){return t.apply(this,arguments)});return i=e.bot,c=void 0===i?(0,o.default)("bot"):i,s=e.topics,f=void 0===s?[]:s,d=e.interactions,l=void 0===d?[]:d,p=e.handlers,v=void 0===p?[]:p,h=e.tokenizers,y=void 0===h?[]:h,b={bot:c,topics:n.default.keyBy(f,"id"),interactions:n.default.keyBy(l,function(e){return e.topicId+":"+e.id})},v.forEach(_),j(y),{use:_,registerTokenizer:g,resolve:E}},e.exports=r.default}])});