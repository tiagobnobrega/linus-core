!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("lodash")):"function"==typeof define&&define.amd?define(["lodash"],r):"object"==typeof exports?exports.LinusDialog=r(require("lodash")):(e.linus=e.linus||{},e.linus.LinusDialog=r(e._))}(this,function(e){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=7)}([,,,,function(e,r,t){"use strict";e.exports=function e(r){var t=new Error('Required parameter, "'+r+'" is missing.');throw"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(t,e),t}},function(r,t){r.exports=e},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=o(t(5)),i=o(t(4));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function u(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function n(i,o){try{var s=r[i](o),u=s.value}catch(e){return void t(e)}if(!s.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}var a=function(){var e,r,t=this;this.src={},this.messageTokenizers={},this.registerTokenizer=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(e&&e.id&&e.tokenize&&n.default.isFunction(e.tokenize)))throw new Error("invalid tokenizer "+(e&&e.id)+": missing or invalid attribute id or fn");if(!1===r&&t.messageTokenizers[e.id.toString()])throw new Error("tokenizer "+e.id+" already registered & overwrite attribute false");t.messageTokenizers[e.id]=e.tokenize},this.runTokenizers=(e=u(regeneratorRuntime.mark(function e(r,n){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.map(function(e){return Promise.resolve(e.tokenize(r))}),e.abrupt("return",Promise.all(i).then(function(e){return Object.assign.apply(Object,s(e))}));case 2:case"end":return e.stop()}},e,t)})),function(r,t){return e.apply(this,arguments)}),this.getTokenizer=function(e){var r=t.messageTokenizers[e];if(!r)throw new Error("Tokenizer "+e+" not registered.");return r},this.getTokenizers=function(e){return e?e.map(t.getTokenizer):[]},this.getTopicTokenizers=function(e){var r=t.getTokenizers(t.src.bot.globalTokenizers),n=t.getTokenizers(e.beforeGlobaltokenizers||[]),i=t.getTokenizers(e.afterGlobaltokenizers||[]);return[].concat(s(n),s(r),s(i))},this.getTopic=function(e){return t.src.topics[e]},this.registerTokenizers=function(e){e.forEach(t.registerTokenizer)},this.use=function(e){var r=e.tokenizers,n=void 0===r?[]:r;t.registerTokenizers(n)},this.resolve=(r=u(regeneratorRuntime.mark(function e(r,n){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.getTopic(n.env.topicId)||t.src.bot.rootTopic,o=t.getTopicTokenizers(i),e.next=4,t.runTokenizers(r,o);case 4:e.sent;case 5:case"end":return e.stop()}},e,t)})),function(e,t){return r.apply(this,arguments)})};r.default=function e(r){var t=r.bot,o=void 0===t?(0,i.default)("bot"):t,s=r.topics,u=void 0===s?[]:s,c=r.interactions,f=void 0===c?[]:c,l=r.handlers,d=void 0===l?[]:l,p=r.tokenizers,h=void 0===p?[]:p;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),a.call(this),this.src={bot:o,topics:n.default.keyBy(u,"id"),interactions:n.default.keyBy(f,function(e){return e.topicId+":"+e.id})},d.forEach(this.use),this.registerTokenizers(h)},e.exports=r.default},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=t(6),o=(n=i)&&n.__esModule?n:{default:n};var s=Symbol("base"),u=Symbol("baseFn"),a=function(e){return function(r){return function(t){e[r].apply(e,function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}(t))}}};r.default=function e(r){var t=this;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.resolve=function(e,r){return t[s].resolve(e,r)},this.use=function(e){return t[s].use(e)},this.registerTokenizer=function(e,r){return t[s].registerTokenizer(e,r)},this[s]=new o.default(r),this[u]=a(this[s])},e.exports=r.default}])});